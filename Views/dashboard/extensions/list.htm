<template id="CImage">
  <link
    rel="stylesheet"
    href="{$_GG['kernel']['assets']}/css/iconfont/shoutao.css"
  />
  <style>
    .image-error {
      display: none;
      align-items: center;
      justify-content: center;
      height: 100%;
      color: #999;
    }
    .image-error i {
      font-size: 20px;
    }
  </style>
  <img />
  <div class="image-error">
    <i class="shoutao st-icon-piclight"></i>
  </div>
</template>

<script type="module" defer>
  import CImage from "{$_GG['kernel']['URLRoot']}/Views/dashboard/extensions/components/CImage.js";
  window.customElements.define("c-image", CImage);
</script>
<script
  src="{$_GG['kernel']['URLRoot']}/Views/dashboard/extensions/js/list.js"
  defer
></script>

<style>
  .components-tips {
    margin-bottom: 10px;
    padding: 7px;
    color: var(--warning-color);
    font-size: 12px;
    letter-spacing: 1px;
    background: white;
    border-radius: 5px;
    opacity: 0.4;
    user-select: none;
    transition: opacity 0.3s linear;
  }
  .components-tips:hover {
    opacity: 1;
  }
  .extension-item {
    display: grid;
    grid-template-columns: 70px auto 220px;
    column-gap: 15px;
    padding-bottom: 15px;
    margin-top: 15px;
    user-select: none;
    border-bottom: 1px solid #f7f5f5;
  }
  .extension-item:first-child {
    margin-top: 0;
  }
  .extension-item:last-child {
    padding-bottom: 0;
    border-bottom: none;
  }
  .extension-icon {
    width: 70px;
    height: 70px;
    border: 1px solid #f7f5f5;
    border-radius: 5px;
  }
  .extension-info {
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }
  .extension-params {
    display: flex;
    margin-top: 5px;
    font-size: 12px;
    color: #999;
  }
  .extension-param-item {
    margin-right: 10px;
  }
  .extension-summary {
    color: #999;
    font-size: 13px;
  }
  .extension-operations {
    text-align: right;
  }
  .operation-status {
    display: none;
    margin-top: 10px;
    font-size: 13px;
  }
</style>

<div class="components-tips">
  {$_GG['langs']['kernel']['extension_new_technology_tips']}
</div>
{if $extensionCount>0}
<ul class="extension-list set-panel">
  {loop $extensions $extensionItem}
  <li class="extension-item" data-extension="{$extensionItem['extension_id']}">
    <c-image
      class="extension-icon"
      src="{$extensionItem['icon']}"
      width="70px"
      height="70px"
      round="true"
    ></c-image>
    <div class="extension-info">
      <div>
        <a
          class="extension-name ellipsis1"
          href="{$extensionItem['link']}"
          target="_blank"
          rel="noopener noreferrer"
          >{$extensionItem['name']}</a
        >
        <ul class="extension-params">
          <li class="extension-param-item">
            <span
              >{$_G['langs']['common']['version']}{$_G['langs']['common']['symbol']['colon']}</span
            >{$extensionItem['version']}
          </li>
          {if $extensionItem['installed']}
          <li class="extension-param-item">
            <span>{$_G['langs']['kernel']['extensionLastUpgradeTime']}</span>
            {$extensionItem['upgradeTime']}
          </li>
          {/if}
        </ul>
      </div>

      <div class="extension-summary ellipsis1">{$extensionItem['summary']}</div>
    </div>
    <div class="extension-operations">
      {if $extensionItem['installed']} {if $extensionItem['enabled']}
      <button
        class="c-button"
        size="mini"
        onclick="openOrCloseExtension(`{$extensionItem['extension_id']}`,`{$extensionItem['enabled']}`)"
      >
        {$_G['langs']['kernel']['extensionClose']}
      </button>
      {else}
      <button
        class="c-button"
        size="mini"
        primary
        onclick="openOrCloseExtension(`{$extensionItem['extension_id']}`,`{$extensionItem['enabled']}`)"
      >
        {$_G['langs']['kernel']['extensionTurnOn']}
      </button>
      {/if}
      <button
        class="c-button"
        size="mini"
        onclick="upgradeExtension(`{$extensionItem['extension_id']}`)"
      >
        {$_G['langs']['common']['update']}
      </button>
      <button
        class="c-button"
        size="mini"
        onclick="uninstallExtension(`{$extensionItem['extension_id']}`)"
      >
        {$_G['langs']['common']['uninstall']}
      </button>
      {else}
      <button
        class="c-button"
        primary
        size="mini"
        onclick="installExtension(`{$extensionItem['extension_id']}`)"
      >
        {$_G['langs']['common']['install']}
      </button>
      {/if}
      <div class="operation-status"></div>
    </div>
  </li>
  {/loop}
</ul>
{else}
<div class="sets-empty c-empty">
  <img
    src="source/plugin/gstudio_kernel/Assets/images/default/empty.png"
    class="c-empty_image"
    width="380"
  />
  <div class="c-empty-description">
    {$_GG['langs']['kernel']['extension_no_install_any']}
  </div>
</div>
{/if}
